<article id="post-43" class="post-43 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-android-tutorials tag-camera tag-fragment-shader tag-matrices tag-modelview-matrix tag-programs tag-projection-matrix tag-shaders tag-vertex-shader">
    
    <div class="post-thumbnail">
    <img width="240" height="400" src="lessonone.png" class="attachment-twentyfourteen-full-width wp-post-image" alt="Visual output of Lesson one.">  </div>

    
    <header class="entry-header">
                <div class="entry-meta">
            <span class="cat-links"><a href="http://www.learnopengles.com/category/android/" rel="category tag">Android</a>, <a href="http://www.learnopengles.com/category/android-tutorials/" rel="category tag">Android Tutorials</a></span>
        </div>
        <h1 class="entry-title">Android Lesson One: Getting Started</h1>
        <div class="entry-meta">
            <span class="entry-date"><a href="http://www.learnopengles.com/android-lesson-one-getting-started/" rel="bookmark"><time class="entry-date" datetime="2011-05-29T01:00:06+00:00">May 29, 2011</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="http://www.learnopengles.com/author/oes_admin/" rel="author">Admin</a></span></span>          <span class="comments-link"><a href="http://www.learnopengles.com/android-lesson-one-getting-started/#comments" title="Comment on Android Lesson One: Getting Started">302 Comments</a></span>
                    </div><!-- .entry-meta -->
    </header><!-- .entry-header -->

    <!-- POST_COUNT:   -->  <div class="entry-content">
        <p>This is the first tutorial on using OpenGL ES 2 on Android. In this lesson, we’re going to go over the code step-by-step, and look at how to create an OpenGL ES 2 context and draw to the screen. We’ll also take a look at what shaders are and how they work, as well as how matrices are used to transform the scene into the image you see on the screen. Finally, we’ll look at what you need to add to the manifest to let the Android market know that you’re using OpenGL ES 2.</p>
<h4>Prerequisites</h4>
<p>Before we begin, you’ll want to make sure you have the following tools installed on your machine:</p>
<ul>
<li><a href="http://developer.android.com/sdk/index.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://developer.android.com/sdk/index.html', 'Android SDK']);" target="_blank">Android SDK</a></li>
<li><a href="http://www.eclipse.org/" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://www.eclipse.org/', 'Eclipse']);" target="_blank">Eclipse</a></li>
<li><a href="http://developer.android.com/sdk/eclipse-adt.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://developer.android.com/sdk/eclipse-adt.html', 'ADT Plugin for Eclipse']);" target="_blank">ADT Plugin for Eclipse</a></li>
</ul>
<p><del datetime="2014-09-17T17:26:01+00:00">Unfortunately, the Android emulator does not support OpenGL ES 2, so you’ll need access to an actual Android device in order to run the tutorial.</del> <a href="http://www.learnopengles.com/android-emulator-now-supports-native-opengl-es2-0/">The Android Emulator now supports OpenGL ES 2</a> in recent versions of the Android SDK. Most recent devices should also support OpenGL ES 2 these days, so all you need to do is enable developer mode and hook the phone up to your machine.</p>
<h4>Assumptions</h4>
<p>The reader should be familiar with Android and Java on a basic level. The <a href="http://developer.android.com/resources/index.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://developer.android.com/resources/index.html', 'Android Tutorials']);" target="_blank">Android Tutorials</a> are a good place to start.</p>
<h4>Getting started</h4>
<p>We’ll go over all of the code below and explain what each part does. You can copy the code on a segment by segment basis by creating your own project, or you can download the completed project at the end of the lesson.&nbsp;Once you have the tools installed, go ahead and create a new Android project in Eclipse. The names don’t matter, but for the lesson I will be referring to the main activity as <em>LessonOneActivity</em>.</p>
<p>Let’s take a look at the code:</p>
<div><div id="highlighter_989274" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/** Hold a reference to our GLSurfaceView */</code></div><div class="line number2 index1 alt1"><code class="java keyword">private</code> <code class="java plain">GLSurfaceView mGLSurfaceView;</code></div></div></td></tr></tbody></table></div></div>
<p>The <a href="http://developer.android.com/reference/android/opengl/GLSurfaceView.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://developer.android.com/reference/android/opengl/GLSurfaceView.html', 'GLSurfaceView']);" target="_blank">GLSurfaceView</a> is a special view which manages OpenGL surfaces for us and draws it into the Android view system. It also adds a lot of features which make it easier to use OpenGL, including but not limited to:</p>
<ul>
<li>It provides a dedicated render thread for OpenGL so that the main thread is not stalled.</li>
<li>It supports continuous or on-demand rendering.</li>
<li>It takes care of the screen setup for you using <a href="http://en.wikipedia.org/wiki/EGL_(OpenGL)" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://en.wikipedia.org/wiki/EGL_(OpenGL)', 'EGL']);" target="_blank">EGL</a>, the interface between OpenGL and the underlying window system.</li>
</ul>
<p>The GLSurfaceView makes setting up and using OpenGL from Android relatively painless.</p>
<div><div id="highlighter_854390" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState)</code></div><div class="line number3 index2 alt2"><code class="java plain">{</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onCreate(savedInstanceState);</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mGLSurfaceView = </code><code class="java keyword">new</code> <code class="java plain">GLSurfaceView(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if the system supports OpenGL ES 2.0.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">ActivityManager activityManager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">ConfigurationInfo configurationInfo = activityManager.getDeviceConfigurationInfo();</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">boolean</code> <code class="java plain">supportsEs2 = configurationInfo.reqGlEsVersion &gt;= </code><code class="java value">0x20000</code><code class="java plain">;</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(supportsEs2)</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Request an OpenGL ES 2.0 compatible context.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mGLSurfaceView.setEGLContextClientVersion(</code><code class="java value">2</code><code class="java plain">);</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set the renderer to our demo renderer, defined below.</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mGLSurfaceView.setRenderer(</code><code class="java keyword">new</code> <code class="java plain">LessonOneRenderer());</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">else</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This is where you could create an OpenGL ES 1.x compatible</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// renderer if you wanted to support both ES 1 and ES 2.</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">setContentView(mGLSurfaceView);</code></div><div class="line number29 index28 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The onCreate() of our activity is the important part where our OpenGL context gets created and where everything starts happening. In our onCreate(), the first thing we do after calling the superclass is creating our GLSurfaceView. We then need to figure out if the system supports OpenGL ES 2. To do this, we get an ActivityManager instance which lets us interact with the global system state. We can then use this to get the device configuration info, which will tell us if the device supports OpenGL ES 2.</p>
<p>Once we know if the device supports OpenGL ES 2 or not, we tell the surface view we want an OpenGL ES 2 compatible surface and then we pass in a custom renderer. This renderer will be called by the system whenever it’s time to adjust the surface or draw a new frame. We can also support OpenGL Es 1.x by passing in a different renderer, though we would need to write different code as the APIs are different. For this lesson we’ll only look at supporting OpenGL ES 2.</p>
<p>Finally, we set the content view to our GLSurfaceView, which tells Android that the activity’s contents should be filled by our OpenGL surface. To get into OpenGL, it’s as easy as that!</p>
<div><div id="highlighter_840487" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onResume()</code></div><div class="line number3 index2 alt2"><code class="java plain">{</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The activity must call the GL surface view's onResume() on activity onResume().</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onResume();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mGLSurfaceView.onResume();</code></div><div class="line number7 index6 alt2"><code class="java plain">}</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java color1">@Override</code></div><div class="line number10 index9 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onPause()</code></div><div class="line number11 index10 alt2"><code class="java plain">{</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The activity must call the GL surface view's onPause() on activity onPause().</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onPause();</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mGLSurfaceView.onPause();</code></div><div class="line number15 index14 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>GLSurfaceView requires that we call its onResume() and onPause() methods whenever the parent Activity has its own onResume() and onPaused() called. We add in the calls here to round out our activity.</p>
<h4>Visualizing a 3D world</h4>
<p>In this section, we’ll start looking at how OpenGL ES 2 works and how we can start drawing stuff onto the screen.&nbsp;In the activity we passed in a custom <a href="http://developer.android.com/reference/android/opengl/GLSurfaceView.Renderer.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://developer.android.com/reference/android/opengl/GLSurfaceView.Renderer.html', 'GLSurfaceView.Renderer']);" target="_blank">GLSurfaceView.Renderer</a> to the GLSurfaceView, which will be defined here. The renderer has three important methods which will be automatically called by the system whenever events happen:</p>
<dl>
<dt>public void onSurfaceCreated(GL10 glUnused, EGLConfig config)</dt>
<dd>This method is called when the surface is first created. It will also be called if we lose our surface context and it is later recreated by the system.</dd>
<dt>public void onSurfaceChanged(GL10 glUnused, int width, int height)</dt>
<dd>This is called whenever the surface changes; for example, when switching from portrait to landscape. It is also called after the surface has been created.</dd>
<dt>public void onDrawFrame(GL10 glUnused) </dt>
<dd>This is called whenever it’s time to draw a new frame.</dd>
</dl>
<p>You may have noticed that the GL10 instance passed in is referred to as glUnused. We don’t use this when drawing using OpenGL ES 2; instead, we use the static methods of the class GLES20. The GL10 parameter is only there because the same interface is used for OpenGL ES 1.x.</p>
<p>Before our renderer can display anything, we’ll need to have something to display. In OpenGL ES 2, we pass in stuff to display by specifying arrays of numbers. These numbers can represent positions, colors, or anything else we need them to. In this demo, we’ll display three triangles.</p>
<div><div id="highlighter_172744" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// New class members</code></div><div class="line number2 index1 alt1"><code class="java preprocessor">/** Store our model data in a float buffer. */</code></div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">FloatBuffer mTriangle1Vertices;</code></div><div class="line number4 index3 alt1"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">FloatBuffer mTriangle2Vertices;</code></div><div class="line number5 index4 alt2"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">FloatBuffer mTriangle3Vertices;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java preprocessor">/** How many bytes per float. */</code></div><div class="line number8 index7 alt1"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mBytesPerFloat = </code><code class="java value">4</code><code class="java plain">;</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="java preprocessor">/**</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Initialize the model data.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number13 index12 alt2"><code class="java keyword">public</code> <code class="java plain">LessonOneRenderer()</code></div><div class="line number14 index13 alt1"><code class="java plain">{</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This triangle is red, green, and blue.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code><code class="java plain">[] triangle1VerticesData = {</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// X, Y, Z,</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// R, G, B, A</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">-</code><code class="java value">0</code><code class="java plain">.5f, -</code><code class="java value">0</code><code class="java plain">.25f, </code><code class="java value">0</code><code class="java plain">.0f,</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java value">1</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f,</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java value">0</code><code class="java plain">.5f, -</code><code class="java value">0</code><code class="java plain">.25f, </code><code class="java value">0</code><code class="java plain">.0f,</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f,</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.559016994f, </code><code class="java value">0</code><code class="java plain">.0f,</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f};</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Initialize the buffers.</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mTriangle1Vertices = ByteBuffer.allocateDirect(triangle1VerticesData.length * mBytesPerFloat)</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.order(ByteOrder.nativeOrder()).asFloatBuffer();</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mTriangle1Vertices.put(triangle1VerticesData).position(</code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number39 index38 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>So, what’s all this about? If you’ve ever used OpenGL 1, you might be used to doing things this way:</p>
<div><div id="highlighter_543980" class="syntaxhighlighter nogutter  cpp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">glBegin(GL_TRIANGLES);</code></div><div class="line number2 index1 alt1"><code class="cpp plain">glVertex3f(-0.5f, -0.25f, 0.0f);</code></div><div class="line number3 index2 alt2"><code class="cpp plain">glColor3f(1.0f, 0.0f, 0.0f);</code></div><div class="line number4 index3 alt1"><code class="cpp plain">...</code></div><div class="line number5 index4 alt2"><code class="cpp plain">glEnd();</code></div></div></td></tr></tbody></table></div></div>
<p>Things don’t work that way in OpenGL ES 2. Instead of defining points via a bunch of method calls, we define an array instead. Let’s take a look at  our array again:</p>
<div><div id="highlighter_931744" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">final</code> <code class="java keyword">float</code><code class="java plain">[] triangle1VerticesData = {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// X, Y, Z,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// R, G, B, A</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">-</code><code class="java value">0</code><code class="java plain">.5f, -</code><code class="java value">0</code><code class="java plain">.25f, </code><code class="java value">0</code><code class="java plain">.0f,</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java value">1</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f,</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div></div></td></tr></tbody></table></div></div>
<p>This represents one point of the triangle. We’ve set things up so that the first three numbers represent the position (X, Y, and Z), and the last four numbers represent the color (red, green, blue, and alpha (transparency)). You don’t need to worry too much about how this array is defined; just remember that when we want to draw stuff in OpenGL ES 2, we need to pass it data in chunks instead of passing it in one at a time.</p>
<h5>Understanding buffers</h5>
<div><div id="highlighter_280812" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Initialize the buffers.</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mTriangle1Vertices = ByteBuffer.allocateDirect(triangle1VerticesData.length * mBytesPerFloat)</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.order(ByteOrder.nativeOrder()).asFloatBuffer();</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mTriangle1Vertices.put(triangle1VerticesData).position(</code><code class="java value">0</code><code class="java plain">);</code></div></div></td></tr></tbody></table></div></div>
<p>We do our coding in Java on Android, but the underlying implementation of OpenGL ES 2 is actually written in C. Before we pass our data to OpenGL, we need to convert it into a form that it’s going to understand. Java and the native system might not store their bytes in the same order, so we use a special set of buffer classes and create a ByteBuffer large enough to hold our data, and tell it to store its data using the native byte order. We then convert it into a FloatBuffer so that we can use it to hold floating-point data. Finally, we copy our array into the buffer.</p>
<p>This buffer stuff might seem confusing (it was to me when I first came across it!), but just remember that it’s an extra step we need to do before passing our data to OpenGL. Our buffers are now ready to be used to pass data into OpenGL.</p>
<p><em>As a side note, <a href="http://code.google.com/p/android/issues/detail?id=11078" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://code.google.com/p/android/issues/detail?id=11078', 'float buffers are slow on Froyo']);" target="_blank">float buffers are slow on Froyo</a> and moderately faster on Gingerbread, so you probably don’t want to be changing them too often.</em><br>
<a name="understanding_matrices"></a></p>
<h5>Understanding matrices</h5>
<div><div id="highlighter_215482" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// New class definitions</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Store the view matrix. This can be thought of as our camera. This matrix transforms world space to eye space;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* it positions things relative to our eye.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number6 index5 alt1"><code class="java keyword">private</code> <code class="java keyword">float</code><code class="java plain">[] mViewMatrix = </code><code class="java keyword">new</code> <code class="java keyword">float</code><code class="java plain">[</code><code class="java value">16</code><code class="java plain">];</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java color1">@Override</code></div><div class="line number9 index8 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onSurfaceCreated(GL10 glUnused, EGLConfig config)</code></div><div class="line number10 index9 alt1"><code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set the background clear color to gray.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glClearColor(</code><code class="java value">0</code><code class="java plain">.5f, </code><code class="java value">0</code><code class="java plain">.5f, </code><code class="java value">0</code><code class="java plain">.5f, </code><code class="java value">0</code><code class="java plain">.5f);</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Position the eye behind the origin.</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">eyeX = </code><code class="java value">0</code><code class="java plain">.0f;</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">eyeY = </code><code class="java value">0</code><code class="java plain">.0f;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">eyeZ = </code><code class="java value">1</code><code class="java plain">.5f;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// We are looking toward the distance</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">lookX = </code><code class="java value">0</code><code class="java plain">.0f;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">lookY = </code><code class="java value">0</code><code class="java plain">.0f;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">lookZ = -</code><code class="java value">5</code><code class="java plain">.0f;</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set our up vector. This is where our head would be pointing were we holding the camera.</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">upX = </code><code class="java value">0</code><code class="java plain">.0f;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">upY = </code><code class="java value">1</code><code class="java plain">.0f;</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">upZ = </code><code class="java value">0</code><code class="java plain">.0f;</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set the view matrix. This matrix can be said to represent the camera position.</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// NOTE: In OpenGL 1, a ModelView matrix is used, which is a combination of a model and</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// view matrix. In OpenGL 2, we can keep track of these matrices separately if we choose.</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Matrix.setLookAtM(mViewMatrix, </code><code class="java value">0</code><code class="java plain">, eyeX, eyeY, eyeZ, lookX, lookY, lookZ, upX, upY, upZ);</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div></div></td></tr></tbody></table></div></div>
<p>Another ‘fun’ topic is matrices! These will become your best friends whenever you do 3D programming, so you’ll want to get to know them well.</p>
<p>When our surface is created, the first thing we do is set our clear color to gray. The alpha part has also been set to gray, but we’re not doing alpha blending in this lesson so this value is unused. We only need to set the clear color once since we will not be changing it later.</p>
<p>The second thing we do is setup our view matrix. There are several different kinds of matrices we use and they all do something important:</p>
<ol>
<li>The model matrix. This matrix is used to place a model somewhere in the “world”. For example, if you have a model of a car and you want it located 1000 meters to the east, you will use the model matrix to do this.</li>
<li>The view matrix. This matrix represents the camera. If we want to view our car which is 1000 meters to the east, we’ll have to move ourselves 1000 meters to the east as well (another way of thinking about it is that we remain stationary, and the rest of the world moves 1000 meters to the west). We use the view matrix to do this.</li>
<li>The projection matrix. Since our screens are flat, we need to do a final transformation to “project” our view onto our screen and get that nice 3D perspective. This is what the projection matrix is used for.</li>
</ol>
<p>A good explanation of this can be found over at <a href="http://www.songho.ca/opengl/gl_transform.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://www.songho.ca/opengl/gl_transform.html', 'SongHo’s OpenGL Tutorials']);" target="_blank">SongHo’s OpenGL Tutorials</a>. I recommend reading it a few times until you grasp the idea well; don’t worry, it took me a few reads as well!</p>
<p><em>In OpenGL 1, the model and view matrices are combined and the camera is assumed to be at (0, 0, 0) and facing the -Z direction. </em></p>
<p>We don’t need to construct these matrices by hand. Android has a Matrix helper class which can do the heavy lifting for us. Here, I create a view matrix for a camera which is positioned behind the origin and looking toward the distance.<br>
<a name="defining_shaders"></a></p>
<h5>Defining vertex and fragment shaders</h5>
<div><div id="highlighter_989831" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">final</code> <code class="java plain">String vertexShader =</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"uniform mat4 u_MVPMatrix;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// A constant representing the combined model/view/projection matrix.</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"attribute vec4 a_Position;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// Per-vertex position information we will pass in.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"attribute vec4 a_Color;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// Per-vertex color information we will pass in.</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"varying vec4 v_Color;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// This will be passed into the fragment shader.</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"void main()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// The entry point for our vertex shader.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"&nbsp;&nbsp; v_Color = a_Color;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// Pass the color through to the fragment shader.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// It will be interpolated across the triangle.</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"&nbsp;&nbsp; gl_Position = u_MVPMatrix&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// gl_Position is a special variable used to store the final position.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * a_Position;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// Multiply the vertex by the matrix to get the final point in</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code><code class="java plain">;&nbsp;&nbsp;&nbsp; </code><code class="java comments">// normalized screen coordinates.</code></div></div></td></tr></tbody></table></div></div>
<p>In OpenGL ES 2, anything we want to display on the screen is first going to have to go through a vertex and fragment shader. The good thing is that these shaders are really not as complicated as they appear. Vertex shaders perform operations on each vertex, and the results of these operations are used in the fragment shaders which do additional calculations per pixel.</p>
<p>Each shader basically consists of input, output, and a program. First we define a uniform, which is a combined matrix containing all of our transformations. This is a constant across all vertices and is used to project them onto the screen. Then we define two attributes for position and color. These attributes will be read in from the buffer we defined earlier on, and specify the position and color of each vertex. We then define a varying, which interpolates values across the triangle and passes it on to the fragment shader. When it gets to the fragment shader, it will hold an interpolated value for each pixel.</p>
<p>Let’s say we defined a triangle with each point being red, green, and blue, and we sized it so that it will take up 10 pixels on the screen. When the fragment shader runs, it will contain a different varying color for each pixel. At one point, that varying will be red, but halfway between red and blue it may be a more purplish color.</p>
<p>Aside from setting the color, we also tell OpenGL what the final position of the vertex should be on the screen. Then we define the fragment shader:</p>
<div><div id="highlighter_556922" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">final</code> <code class="java plain">String fragmentShader =</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"precision mediump float;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// Set the default precision to medium. We don't need as high of a</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// precision in the fragment shader.</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"varying vec4 v_Color;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// This is the color from the vertex shader interpolated across the</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// triangle per fragment.</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"void main()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// The entry point for our fragment shader.</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"&nbsp;&nbsp; gl_FragColor = v_Color;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="java comments">// Pass the color directly through the pipeline.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n"</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
<p>This is the fragment shader which will actually put stuff on the screen. In this shader, we grab the varying color from the vertex shader, and just pass it straight through to OpenGL. The point is already interpolated per pixel since the fragment shader runs for each pixel that will be drawn.</p>
<p>More information can be found on the <a href="http://www.khronos.org/opengles/sdk/docs/reference_cards/OpenGL-ES-2_0-Reference-card.pdf" onclick="_gaq.push(['_trackEvent','download','http://www.khronos.org/opengles/sdk/docs/reference_cards/OpenGL-ES-2_0-Reference-card.pdf']);" target="_blank">OpenGL ES 2 quick reference card</a>.<br>
<a name="loading_shaders"></a></p>
<h5>Loading shaders into OpenGL</h5>
<div><div id="highlighter_454869" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Load in the vertex shader.</code></div><div class="line number2 index1 alt1"><code class="java keyword">int</code> <code class="java plain">vertexShaderHandle = GLES20.glCreateShader(GLES20.GL_VERTEX_SHADER);</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java keyword">if</code> <code class="java plain">(vertexShaderHandle != </code><code class="java value">0</code><code class="java plain">)</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Pass in the shader source.</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glShaderSource(vertexShaderHandle, vertexShader);</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Compile the shader.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glCompileShader(vertexShaderHandle);</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Get the compilation status.</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">int</code><code class="java plain">[] compileStatus = </code><code class="java keyword">new</code> <code class="java keyword">int</code><code class="java plain">[</code><code class="java value">1</code><code class="java plain">];</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glGetShaderiv(vertexShaderHandle, GLES20.GL_COMPILE_STATUS, compileStatus, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If the compilation failed, delete the shader.</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(compileStatus[</code><code class="java value">0</code><code class="java plain">] == </code><code class="java value">0</code><code class="java plain">)</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glDeleteShader(vertexShaderHandle);</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">vertexShaderHandle = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1"><code class="java plain">}</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="java keyword">if</code> <code class="java plain">(vertexShaderHandle == </code><code class="java value">0</code><code class="java plain">)</code></div><div class="line number25 index24 alt2"><code class="java plain">{</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">RuntimeException(</code><code class="java string">"Error creating vertex shader."</code><code class="java plain">);</code></div><div class="line number27 index26 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>First, we create the shader object. If this succeeded, we’ll get a reference to the object. Then we use this reference to pass in the shader source code, and then we compile it. We can obtain the status from OpenGL and see if it compiled successfully. If there were errors, we can use <em>GLES20.glGetShaderInfoLog(shader)</em> to find out why. We follow the same steps to load the fragment shader.</p>
<h5>Linking a vertex and fragment shader together into a program</h5>
<div><div id="highlighter_360188" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Create a program object and store the handle to it.</code></div><div class="line number2 index1 alt1"><code class="java keyword">int</code> <code class="java plain">programHandle = GLES20.glCreateProgram();</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java keyword">if</code> <code class="java plain">(programHandle != </code><code class="java value">0</code><code class="java plain">)</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Bind the vertex shader to the program.</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glAttachShader(programHandle, vertexShaderHandle);</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Bind the fragment shader to the program.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glAttachShader(programHandle, fragmentShaderHandle);</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Bind attributes</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glBindAttribLocation(programHandle, </code><code class="java value">0</code><code class="java plain">, </code><code class="java string">"a_Position"</code><code class="java plain">);</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glBindAttribLocation(programHandle, </code><code class="java value">1</code><code class="java plain">, </code><code class="java string">"a_Color"</code><code class="java plain">);</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Link the two shaders together into a program.</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glLinkProgram(programHandle);</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Get the link status.</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">int</code><code class="java plain">[] linkStatus = </code><code class="java keyword">new</code> <code class="java keyword">int</code><code class="java plain">[</code><code class="java value">1</code><code class="java plain">];</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glGetProgramiv(programHandle, GLES20.GL_LINK_STATUS, linkStatus, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If the link failed, delete the program.</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(linkStatus[</code><code class="java value">0</code><code class="java plain">] == </code><code class="java value">0</code><code class="java plain">)</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glDeleteProgram(programHandle);</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">programHandle = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number29 index28 alt2"><code class="java plain">}</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="java keyword">if</code> <code class="java plain">(programHandle == </code><code class="java value">0</code><code class="java plain">)</code></div><div class="line number32 index31 alt1"><code class="java plain">{</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">RuntimeException(</code><code class="java string">"Error creating program."</code><code class="java plain">);</code></div><div class="line number34 index33 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Before we can use our vertex and fragment shader, we need to bind them together into a program. This is what connects the output of the vertex shader with the input of the fragment shader. It’s also what lets us pass in input from our program and use the shader to draw our shapes.</p>
<p>We create a new program object, and if that succeeded, we then attach our shaders. We want to pass in the position and color as attributes, so we need to bind these attributes. We then link the shaders together.</p>
<div><div id="highlighter_237536" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">//New class members</code></div><div class="line number2 index1 alt1"><code class="java preprocessor">/** This will be used to pass in the transformation matrix. */</code></div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">int</code> <code class="java plain">mMVPMatrixHandle;</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="java preprocessor">/** This will be used to pass in model position information. */</code></div><div class="line number6 index5 alt1"><code class="java keyword">private</code> <code class="java keyword">int</code> <code class="java plain">mPositionHandle;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java preprocessor">/** This will be used to pass in model color information. */</code></div><div class="line number9 index8 alt2"><code class="java keyword">private</code> <code class="java keyword">int</code> <code class="java plain">mColorHandle;</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java color1">@Override</code></div><div class="line number12 index11 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onSurfaceCreated(GL10 glUnused, EGLConfig config)</code></div><div class="line number13 index12 alt2"><code class="java plain">{</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set program handles. These will later be used to pass in values to the program.</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mMVPMatrixHandle = GLES20.glGetUniformLocation(programHandle, </code><code class="java string">"u_MVPMatrix"</code><code class="java plain">);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mPositionHandle = GLES20.glGetAttribLocation(programHandle, </code><code class="java string">"a_Position"</code><code class="java plain">);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mColorHandle = GLES20.glGetAttribLocation(programHandle, </code><code class="java string">"a_Color"</code><code class="java plain">);</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Tell OpenGL to use this program when rendering.</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glUseProgram(programHandle);</code></div><div class="line number23 index22 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>After we successfully linked our program, we finish up with a couple more tasks so we can actually use it. The first task is obtaining references so we can pass data into the program. Then we tell OpenGL to use this program when drawing. Since we only use one program in this lesson, we can put this in the onSurfaceCreated() instead of the onDrawFrame().</p>
<h5>Setting the perspective projection</h5>
<div><div id="highlighter_829360" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// New class members</code></div><div class="line number2 index1 alt1"><code class="java preprocessor">/** Store the projection matrix. This is used to project the scene onto a 2D viewport. */</code></div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">float</code><code class="java plain">[] mProjectionMatrix = </code><code class="java keyword">new</code> <code class="java keyword">float</code><code class="java plain">[</code><code class="java value">16</code><code class="java plain">];</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="java color1">@Override</code></div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onSurfaceChanged(GL10 glUnused, </code><code class="java keyword">int</code> <code class="java plain">width, </code><code class="java keyword">int</code> <code class="java plain">height)</code></div><div class="line number7 index6 alt2"><code class="java plain">{</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set the OpenGL viewport to the same size as the surface.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glViewport(</code><code class="java value">0</code><code class="java plain">, </code><code class="java value">0</code><code class="java plain">, width, height);</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Create a new perspective projection matrix. The height will stay the same</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// while the width will vary as per aspect ratio.</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">ratio = (</code><code class="java keyword">float</code><code class="java plain">) width / height;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">left = -ratio;</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">right = ratio;</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">bottom = -</code><code class="java value">1</code><code class="java plain">.0f;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">top = </code><code class="java value">1</code><code class="java plain">.0f;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">near = </code><code class="java value">1</code><code class="java plain">.0f;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">float</code> <code class="java plain">far = </code><code class="java value">10</code><code class="java plain">.0f;</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Matrix.frustumM(mProjectionMatrix, </code><code class="java value">0</code><code class="java plain">, left, right, bottom, top, near, far);</code></div><div class="line number22 index21 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Our onSurfaceChanged() is called at least once and also whenever our surface is changed. Since we only need to reset our projection matrix whenever the screen we’re projecting onto has changed, onSurfaceChanged() is an ideal place to do it.<br>
<a name="rendering"></a></p>
<h5>Drawing stuff to the screen!</h5>
<div><div id="highlighter_168370" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// New class members</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Store the model matrix. This matrix is used to move models from object space (where each model can be thought</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* of being located at the center of the universe) to world space.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">float</code><code class="java plain">[] mModelMatrix = </code><code class="java keyword">new</code> <code class="java keyword">float</code><code class="java plain">[</code><code class="java value">16</code><code class="java plain">];</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onDrawFrame(GL10 glUnused)</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glClear(GLES20.GL_DEPTH_BUFFER_BIT | GLES20.GL_COLOR_BUFFER_BIT);</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Do a complete rotation every 10 seconds.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">long</code> <code class="java plain">time = SystemClock.uptimeMillis() % 10000L;</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">float</code> <code class="java plain">angleInDegrees = (</code><code class="java value">360</code><code class="java plain">.0f / </code><code class="java value">10000</code><code class="java plain">.0f) * ((</code><code class="java keyword">int</code><code class="java plain">) time);</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Draw the triangle facing straight on.</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Matrix.setIdentityM(mModelMatrix, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Matrix.rotateM(mModelMatrix, </code><code class="java value">0</code><code class="java plain">, angleInDegrees, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">0</code><code class="java plain">.0f, </code><code class="java value">1</code><code class="java plain">.0f);</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">drawTriangle(mTriangle1Vertices);</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number23 index22 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>This is where stuff actually get displayed on the screen. We clear the screen so we don’t get any weird <a href="http://en.wikipedia.org/wiki/Hall_of_mirrors_effect#.22Hall_of_mirrors.22_effect" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://en.wikipedia.org/wiki/Hall_of_mirrors_effect#.22Hall_of_mirrors.22_effect', 'hall of mirror']);" target="_blank">hall of mirror</a> effects, and we want our triangles to animate smoothly so we rotate them using time. Whenever you animate something on the screen, it’s usually better to use time instead of framerate.</p>
<p>The actual drawing is done in drawTriangle:</p>
<div><div id="highlighter_857750" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// New class members</code></div><div class="line number2 index1 alt1"><code class="java preprocessor">/** Allocate storage for the final combined matrix. This will be passed into the shader program. */</code></div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">float</code><code class="java plain">[] mMVPMatrix = </code><code class="java keyword">new</code> <code class="java keyword">float</code><code class="java plain">[</code><code class="java value">16</code><code class="java plain">];</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="java preprocessor">/** How many elements per vertex. */</code></div><div class="line number6 index5 alt1"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mStrideBytes = </code><code class="java value">7</code> <code class="java plain">* mBytesPerFloat;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java preprocessor">/** Offset of the position data. */</code></div><div class="line number9 index8 alt2"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mPositionOffset = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java preprocessor">/** Size of the position data in elements. */</code></div><div class="line number12 index11 alt1"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mPositionDataSize = </code><code class="java value">3</code><code class="java plain">;</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="java preprocessor">/** Offset of the color data. */</code></div><div class="line number15 index14 alt2"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mColorOffset = </code><code class="java value">3</code><code class="java plain">;</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java preprocessor">/** Size of the color data in elements. */</code></div><div class="line number18 index17 alt1"><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mColorDataSize = </code><code class="java value">4</code><code class="java plain">;</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="java preprocessor">/**</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Draws a triangle from the given vertex data.</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* @param aTriangleBuffer The buffer containing the vertex data.</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number25 index24 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">drawTriangle(</code><code class="java keyword">final</code> <code class="java plain">FloatBuffer aTriangleBuffer)</code></div><div class="line number26 index25 alt1"><code class="java plain">{</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Pass in the position information</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">aTriangleBuffer.position(mPositionOffset);</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glVertexAttribPointer(mPositionHandle, mPositionDataSize, GLES20.GL_FLOAT, </code><code class="java keyword">false</code><code class="java plain">,</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mStrideBytes, aTriangleBuffer);</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glEnableVertexAttribArray(mPositionHandle);</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Pass in the color information</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">aTriangleBuffer.position(mColorOffset);</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glVertexAttribPointer(mColorHandle, mColorDataSize, GLES20.GL_FLOAT, </code><code class="java keyword">false</code><code class="java plain">,</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mStrideBytes, aTriangleBuffer);</code></div><div class="line number38 index37 alt1">&nbsp;</div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glEnableVertexAttribArray(mColorHandle);</code></div><div class="line number40 index39 alt1">&nbsp;</div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This multiplies the view matrix by the model matrix, and stores the result in the MVP matrix</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// (which currently contains model * view).</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Matrix.multiplyMM(mMVPMatrix, </code><code class="java value">0</code><code class="java plain">, mViewMatrix, </code><code class="java value">0</code><code class="java plain">, mModelMatrix, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This multiplies the modelview matrix by the projection matrix, and stores the result in the MVP matrix</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// (which now contains model * view * projection).</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Matrix.multiplyMM(mMVPMatrix, </code><code class="java value">0</code><code class="java plain">, mProjectionMatrix, </code><code class="java value">0</code><code class="java plain">, mMVPMatrix, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number48 index47 alt1">&nbsp;</div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glUniformMatrix4fv(mMVPMatrixHandle, </code><code class="java value">1</code><code class="java plain">, </code><code class="java keyword">false</code><code class="java plain">, mMVPMatrix, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GLES20.glDrawArrays(GLES20.GL_TRIANGLES, </code><code class="java value">0</code><code class="java plain">, </code><code class="java value">3</code><code class="java plain">);</code></div><div class="line number51 index50 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Do you remember those buffers we defined when we originally created our renderer? We’re finally going to be able to use them. We need to tell OpenGL how to use this data using GLES20.glVertexAttribPointer(). Let’s look at the first call.</p>
<div><div id="highlighter_140162" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Pass in the position information</code></div><div class="line number2 index1 alt1"><code class="java plain">aTriangleBuffer.position(mPositionOffset);</code></div><div class="line number3 index2 alt2"><code class="java plain">GLES20.glVertexAttribPointer(mPositionHandle, mPositionDataSize, GLES20.GL_FLOAT, </code><code class="java keyword">false</code><code class="java plain">,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mStrideBytes, aTriangleBuffer);</code></div><div class="line number5 index4 alt2"><code class="java plain">GLES20.glEnableVertexAttribArray(mPositionHandle);</code></div></div></td></tr></tbody></table></div></div>
<p>We set our buffer position to the position offset, which is at the beginning of the buffer. We then tell OpenGL to use this data and feed it into the vertex shader and apply it to our position attribute. We also need to tell OpenGL how many elements there are between each vertex, or the <em>stride</em>.</p>
<p><em>Note: The stride needs to be defined in <strong>bytes</strong>. Although we have 7 elements (3 for the position, 4 for the color) between vertices, we actually have 28 bytes, since each floating point number takes up 4 bytes. Forgetting this step may not cause any errors, but you will be wondering why you don’t see anything on the screen.</em></p>
<p>Finally, we enable the vertex attribute and move on to the next attribute. A little bit further down we build a combined matrix to project points onto the screen. We could do this in the vertex shader, too, but since it only needs to be done once we may as well just cache the result. We pass in the final matrix to the vertex shader using GLES20.glUniformMatrix4fv() and GLES20.glDrawArrays() converts our points into a triangle and draws it on the screen.</p>
<h4>Recap</h4>
<p><a rel="attachment wp-att-49" href="http://www.learnopengles.com/android-lesson-one-getting-started/lessonone/"><img class="size-medium wp-image-49 alignright" title="lessonone" src="lessonone-180x300.png" alt="Visual output of Lesson one." width="180" height="300"></a>Whew! This was a big lesson, and kudos to you if you made it all the way through. We learned how to create our OpenGL context, pass shape data, load in a vertex and pixel shader, set up our transformation matrices, and finally bring it all together. If everything went well, you should see something similar to the screenshot on the right.</p>
<p>This lesson was a lot to digest and you may need to go over the steps a few times to understand it well. OpenGL ES 2 takes more setup work to get going, but once you’ve been through the process a few times you’ll remember the flow by the back of your hand.</p>
<h5>Publishing on Android Market</h5>
<p>When developing apps, we wouldn’t want people unable to run those apps to see them in the market, otherwise we could end up with a lot of bad reviews and ratings when the app crashes on their device. To prevent an OpenGL ES 2 app from appearing on a device which doesn’t support it, you can add this to your manifest:</p>
<p><code>&lt;uses-feature<br>
android:glEsVersion="0x00020000"<br>
android:required="true" /&gt;</code></p>
<p>This tells the Market that your app requires OpenGL ES 2, and it will hide your app from devices which don’t support it.</p>
<h4>Exploring further</h4>
<p>Try changing the animation speed, vertex points, or colors, and see what happens!</p>
<p>The full source code for this lesson can be <a href="https://github.com/learnopengles/Learn-OpenGLES-Tutorials" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'https://github.com/learnopengles/Learn-OpenGLES-Tutorials', 'downloaded from the project site']);" target="_blank">downloaded from the project site</a> on GitHub.</p>
<p>A compiled version of the lesson can also be <a href="https://market.android.com/details?id=com.learnopengles.android" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'https://market.android.com/details?id=com.learnopengles.android', 'downloaded directly']);" target="_blank">downloaded directly</a> from the Android Market.</p>
<p><a rel="attachment wp-att-124" href="http://www.learnopengles.com/android-lesson-one-getting-started/market-qr-code/" target="_blank"><img class="alignnone size-full wp-image-124" src="market-qr-code.png" alt="QR code for link to the app on the Android Market." width="120" height="120"></a></p>
<p>I also recommend looking at the code in <em>ApiDemos</em>, which can be found under the Samples folder in your Android SDK. The code in there helped me out a lot when I was preparing this lesson.</p>
<p>Please don’t hesitate to ask any questions or offer feedback, and thanks for stopping by!</p>

<div style="padding: 15px 15px 0 15px; margin: 0 0 0 0; border: 1px solid #e6e6e6; background: #fafafa; border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px;">
        <iframe border="0px" height="182px" seamless="true" scrolling="no" src="http://pragprog.com/products/buy_now_insert/kbogla" width="155px" style="float: left; margin: 0 15px 5px 0; padding: 0; border: none;">Buy Now</iframe>
    <div>
        <h4 style="display: inline;">About the book</h4>
        <div style="margin-top: 0.7em;"><p>Android is booming like never before, with millions of devices shipping every day. In <em><a href="http://pragprog.com/book/kbogla/opengl-es-2-for-android" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://pragprog.com/book/kbogla/opengl-es-2-for-android', 'OpenGL ES 2 for Android: A Quick-Start Guide']);">OpenGL ES 2 for Android: A Quick-Start Guide</a></em>, you’ll learn all about shaders and the OpenGL pipeline, and discover the power of OpenGL ES 2.0, which is much more feature-rich than its predecessor.</p><p>It’s never been a better time to learn how to create your own 3D games and live wallpapers. If you can program in Java and you have a creative vision that you’d like to share with the world, then this is the book for you.</p></div>
    </div>
</div><div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="" style="line-height: 32px;"><a href="https://www.addtoany.com/share_save#url=http%3A%2F%2Fwww.learnopengles.com%2Fandroid-lesson-one-getting-started%2F&amp;title=Android%20Lesson%20One%3A%20Getting%20Started&amp;description=This%20is%20the%20first%20tutorial%20on%20using%20OpenGL%20ES%202%20on%20Android.%20In%20this%20lesson%2C%20we%27re%20going%20to%20go%20over%20the%20code%20step-by-step%2C%20and%20look%20at%20how%20to%20create%20an%20OpenGL%20ES" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'https://www.addtoany.com/share_save', '']);" class="a2a_dd addtoany_share_save"><img src="share_save_256_24.png" width="256" height="24" alt="Share"></a>
<script type="text/javascript"><!--
wpa2a.script_load();
//--></script>
</div></div>    </div><!-- .entry-content -->
    
    <footer class="entry-meta"><span class="tag-links"><a href="http://www.learnopengles.com/tag/camera/" rel="tag">camera</a><a href="http://www.learnopengles.com/tag/fragment-shader/" rel="tag">fragment shader</a><a href="http://www.learnopengles.com/tag/matrices/" rel="tag">matrices</a><a href="http://www.learnopengles.com/tag/modelview-matrix/" rel="tag">modelview matrix</a><a href="http://www.learnopengles.com/tag/programs/" rel="tag">programs</a><a href="http://www.learnopengles.com/tag/projection-matrix/" rel="tag">projection matrix</a><a href="http://www.learnopengles.com/tag/shaders/" rel="tag">shaders</a><a href="http://www.learnopengles.com/tag/vertex-shader/" rel="tag">vertex shader</a></span></footer></article>